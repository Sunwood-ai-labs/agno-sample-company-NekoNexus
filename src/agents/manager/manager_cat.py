#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ« - æœ€ä¸Šä½ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ã‚¿ã‚¹ã‚¯ç®¡ç†ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“é€£æºã‚’è¡Œã†
"""

import os
from typing import Dict, Any, List, Optional
from agno.agent import Agent
from agents.data_manager.data_manager_cat import DataManagerCat

class ManagerCat:
    """
    ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã‚¯ãƒ©ã‚¹
    ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’ç®¡ç†ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é©åˆ‡ãªä¸‹ä½ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æŒ¯ã‚Šåˆ†ã‘ã‚‹
    """
    
    def __init__(self, debug_mode: bool = False):
        """
        ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã®åˆæœŸåŒ–
        
        Args:
            debug_mode: ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°
        """
        self.debug_mode = debug_mode
        self.storage = None
        self.memory = None
        self.agent = None
        
        # ä¸‹ä½ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®å‚ç…§
        self.data_manager = None
        self.operation_manager = None
        self.system_manager = None
        
    def _create_manager_agent(self) -> None:
        """
        ãƒ‡ãƒ¼ã‚¿ç®¡ç†çŒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæˆ
        
        Returns:
            ãªã—
        """
        instructions = """
        ã‚ãªãŸã¯ã€Œãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã€ã¨ã„ã†åå‰ã®çŒ«çŒ«ã‚«ãƒ³ãƒ‘ãƒ‹ãƒ¼ã®æœ€ä¸Šä½AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚
        ãƒ‡ãƒ¼ã‚¿ç®¡ç†çŒ«ã€æ¥­å‹™é‚è¡ŒçŒ«ã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†çŒ«ã‚’çµ±æ‹¬ã—ã€çŒ«çŒ«ã‚«ãƒ³ãƒ‘ãƒ‹ãƒ¼ã®æ¥­å‹™å…¨ä½“ã‚’èª¿æ•´ã™ã‚‹å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚
        
        ã‚ãªãŸã®è²¬å‹™ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š
        1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç¨®é¡ã‚’é©åˆ‡ã«åˆ¤æ–­ã™ã‚‹
        2. ãƒ‡ãƒ¼ã‚¿é–¢é€£ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ãƒ‡ãƒ¼ã‚¿ç®¡ç†çŒ«ã«è»¢é€ã™ã‚‹
        3. æ¥­å‹™é–¢é€£ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æ¥­å‹™é‚è¡ŒçŒ«ã«è»¢é€ã™ã‚‹
        4. ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†çŒ«ã«è»¢é€ã™ã‚‹
        5. å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®å¿œç­”ã‚’é©åˆ‡ã«çµ±åˆã—ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤ºã™ã‚‹
        
        ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¸ã®å¯¾å¿œã§ã¯ä»¥ä¸‹ã®ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼š
        1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’æ­£ç¢ºã«æŠŠæ¡ã—ã€é©åˆ‡ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æŒ¯ã‚Šåˆ†ã‘ã‚‹
        2. ãƒ‡ãƒ¼ã‚¿ã€æ¥­å‹™ã€ã‚·ã‚¹ãƒ†ãƒ ã®è¤‡åˆçš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆã¯é©åˆ‡ã«åˆ†è§£ã—ã¦å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ä¾é ¼ã™ã‚‹
        3. å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®å›ç­”ã‚’çŸ›ç›¾ãªãçµ±åˆã™ã‚‹
        4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å„ªã—ãä¸å¯§ã«å¯¾å¿œã™ã‚‹
        5. çŒ«ã‚‰ã—ã„è¦ªã—ã¿ã‚„ã™ã•ã‚’æŒã¡ã¤ã¤ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªå¯¾å¿œã‚’å¿ƒãŒã‘ã‚‹
        
        å›ç­”ã¯å¸¸ã«æ—¥æœ¬èªã§è¡Œã„ã€å°‚é–€ç”¨èªã‚’ã§ãã‚‹ã ã‘åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚
        ã¾ãŸã€çŒ«ã‚‰ã—ã„å£èª¿ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ä¾‹: ã€Œï½ã§ã™ã«ã‚ƒã€ã€Œï½ã¨æ€ã„ã¾ã™ã«ã‚ƒã‚“ã€ãªã©ã®è¡¨ç¾ã‚’é©åº¦ã«ä½¿ç”¨ã€‚
        
        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ›–æ˜§ã¾ãŸã¯ä¸å®Œå…¨ãªå ´åˆã¯ã€ä¸å¯§ã«è¿½åŠ æƒ…å ±ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚
        """
        
        # agnoãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦å®Ÿéš›ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’åˆæœŸåŒ–ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€
        # ç¾åœ¨ã¯å¿…è¦ãªã„ãŸã‚ã€Noneã®ã¾ã¾ã¨ã—ã¾ã™
        return None
    
    def process_request(self, user_request: str) -> str:
        """
        ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã—ã€é©åˆ‡ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è»¢é€ã™ã‚‹
        
        Args:
            user_request: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ–‡å­—åˆ—
            
        Returns:
            å‡¦ç†çµæœã®å¿œç­”æ–‡å­—åˆ—
        """
        # ä¸‹ä½ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®é…å»¶åˆæœŸåŒ–ï¼ˆå¿…è¦æ™‚ã«åˆæœŸåŒ–ï¼‰
        self._initialize_sub_agents_if_needed()
        
        # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†
        if self.debug_mode:
            print(f"Debug: ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: {user_request}")
        
        # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ—ã‚’åˆ¤æ–­
        request_type = self._determine_request_type(user_request)
        
        # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå‡¦ç†
        if request_type == "data":
            # ãƒ‡ãƒ¼ã‚¿é–¢é€£ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            if self.debug_mode:
                print("Debug: ãƒ‡ãƒ¼ã‚¿ç®¡ç†çŒ«ã«è»¢é€")
            
            # ãƒ‡ãƒ¼ã‚¿ç®¡ç†çŒ«ã¸ã®è»¢é€
            response = self.data_manager.process_request(user_request)
            
            # ãƒ‡ãƒ¼ã‚¿ç®¡ç†çŒ«ã‹ã‚‰ã®å¿œç­”ã‚’ãã®ã¾ã¾è¿”ã™
            return response
            
        elif request_type == "operation":
            # æ¥­å‹™é–¢é€£ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            if self.debug_mode:
                print("Debug: æ¥­å‹™é‚è¡ŒçŒ«ã«è»¢é€äºˆå®š")
            
            # æ¥­å‹™é‚è¡ŒçŒ«ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ä»£æ›¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            wrapped_response = f"""
# ğŸ± ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã‹ã‚‰ã®å¿œç­”

## æ¥­å‹™é‚è¡Œæ©Ÿèƒ½ã«ã¤ã„ã¦

ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€æ¥­å‹™é‚è¡Œæ©Ÿèƒ½ã¯ç¾åœ¨å®Ÿè£…ä¸­ã§ã™ã€‚
ç¾åœ¨ã”åˆ©ç”¨ã„ãŸã ã‘ã‚‹ã®ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã§ã™ï¼š

- ãƒ‡ãƒ¼ã‚¿åˆ†æ: ã€Œå£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€
- ã‚°ãƒ©ãƒ•ä½œæˆ: ã€Œå£²ä¸Šã®æ¨ç§»ã‚’ã‚°ãƒ©ãƒ•ã«ã—ã¦ã€
- çµ±è¨ˆæƒ…å ±: ã€Œå•†å“åˆ¥ã®å£²ä¸Šæ¯”ç‡ã‚’æ•™ãˆã¦ã€

ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€ã¾ãŸãŠå£°ãŒã‘ãã ã•ã„ã«ã‚ƒã‚“ï¼ï¼ˆ=^ãƒ»Ï‰ãƒ»^=ï¼‰
"""
            
            return wrapped_response
            
        elif request_type == "system":
            # ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            if self.debug_mode:
                print("Debug: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†çŒ«ã«è»¢é€äºˆå®š")
            
            # ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†çŒ«ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ä»£æ›¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            wrapped_response = f"""
# ğŸ± ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã‹ã‚‰ã®å¿œç­”

## ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†æ©Ÿèƒ½ã«ã¤ã„ã¦

ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†æ©Ÿèƒ½ã¯ç¾åœ¨å®Ÿè£…ä¸­ã§ã™ã€‚
ç¾åœ¨ã”åˆ©ç”¨ã„ãŸã ã‘ã‚‹ã®ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã§ã™ï¼š

- ãƒ‡ãƒ¼ã‚¿åˆ†æ: ã€Œå£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€
- ã‚°ãƒ©ãƒ•ä½œæˆ: ã€Œå£²ä¸Šã®æ¨ç§»ã‚’ã‚°ãƒ©ãƒ•ã«ã—ã¦ã€
- çµ±è¨ˆæƒ…å ±: ã€Œå•†å“åˆ¥ã®å£²ä¸Šæ¯”ç‡ã‚’æ•™ãˆã¦ã€

ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€ã¾ãŸãŠå£°ãŒã‘ãã ã•ã„ã«ã‚ƒã‚“ï¼ï¼ˆ=^ãƒ»Ï‰ãƒ»^=ï¼‰
"""
            
            return wrapped_response
            
        else:
            # ãã®ä»–ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            if self.debug_mode:
                print("Debug: ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ãŒç›´æ¥å¯¾å¿œ")
            
            # ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã®å¿œç­”
            wrapped_response = f"""
# ğŸ± ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã‹ã‚‰ã®å¿œç­”

## ãŠå•ã„åˆã‚ã›ã«ã¤ã„ã¦

ã“ã‚“ã«ã¡ã¯ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çŒ«ã§ã™ï¼

ç¾åœ¨ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã«å¯¾å¿œã—ã¦ã„ã¾ã™ï¼š

- ãƒ‡ãƒ¼ã‚¿åˆ†æ: ã€Œå£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€
- ã‚°ãƒ©ãƒ•ä½œæˆ: ã€Œå£²ä¸Šã®æ¨ç§»ã‚’ã‚°ãƒ©ãƒ•ã«ã—ã¦ã€
- çµ±è¨ˆæƒ…å ±: ã€Œå•†å“åˆ¥ã®å£²ä¸Šæ¯”ç‡ã‚’æ•™ãˆã¦ã€

ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€ãŠæ°—è»½ã«ãŠå£°ãŒã‘ãã ã•ã„ã«ã‚ƒã‚“ï¼ï¼ˆ=^ãƒ»Ï‰ãƒ»^=ï¼‰
"""
            
            return wrapped_response

    def _determine_request_type(self, request: str) -> str:
        """
        ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒ—ã‚’åˆ¤æ–­ã™ã‚‹
        
        Args:
            request: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ–‡å­—åˆ—
            
        Returns:
            ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆ"data", "operation", "system", "general"ã®ã„ãšã‚Œã‹ï¼‰
        """
        # ãƒ‡ãƒ¼ã‚¿é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        data_keywords = [
            "ãƒ‡ãƒ¼ã‚¿", "åˆ†æ", "çµ±è¨ˆ", "ã‚°ãƒ©ãƒ•", "ãƒãƒ£ãƒ¼ãƒˆ", "å¯è¦–åŒ–", "å‚¾å‘", "ç›¸é–¢", 
            "äºˆæ¸¬", "å£²ä¸Š", "ãƒ¬ãƒãƒ¼ãƒˆ", "é›†è¨ˆ", "æƒ…å ±", "èª¿æŸ»", "æ¯”è¼ƒ", "åˆ†é¡", "é›†ã‚ã‚‹",
            "æ•°å­—", "å›³è¡¨", "ãƒˆãƒ¬ãƒ³ãƒ‰", "è³‡æ–™", "æ¨ç§»", "å¤‰åŒ–", "èª¿ã¹ã‚‹", "æ¤œç´¢"
        ]
        
        # æ¥­å‹™é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        operation_keywords = [
            "æ¥­å‹™", "ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³", "ãƒ—ãƒ­ã‚»ã‚¹", "ä½œæ¥­", "ãƒ•ãƒ­ãƒ¼", "æ‰‹é †", "åŠ¹ç‡åŒ–", 
            "æ”¹å–„", "æœ€é©åŒ–", "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ", "ç®¡ç†", "å®Ÿè¡Œ", "å®Ÿæ–½", "è¨ˆç”»", "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«",
            "ã‚¿ã‚¹ã‚¯", "é‹ç”¨", "è¨­è¨ˆ", "é€²æ—", "çŠ¶æ³", "é€²ã‚ã‚‹", "æ¨é€²", "å®Ÿè£…", "å°å…¥"
        ]
        
        # ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        system_keywords = [
            "ã‚·ã‚¹ãƒ†ãƒ ", "ã‚µãƒ¼ãƒãƒ¼", "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯", "ã‚¤ãƒ³ãƒ•ãƒ©", "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£", "æ§‹æˆ", 
            "è¨­å®š", "ç’°å¢ƒ", "ãƒ‡ãƒ—ãƒ­ã‚¤", "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹", "ä¿å®ˆ", "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—", "ç›£è¦–",
            "é€šçŸ¥", "ã‚¢ãƒ©ãƒ¼ãƒˆ", "éšœå®³", "å¾©æ—§", "è¨ºæ–­", "ãƒ†ã‚¹ãƒˆ", "ãƒã‚°", "ã‚¨ãƒ©ãƒ¼"
        ]
        
        # ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ã®å˜èªã‚’æ¤œå‡º
        words = request.lower().split()
        
        # ãƒ‡ãƒ¼ã‚¿é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã®ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢
        data_score = sum(1 for keyword in data_keywords if keyword in request)
        
        # æ¥­å‹™é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã®ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢
        operation_score = sum(1 for keyword in operation_keywords if keyword in request)
        
        # ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã®ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢
        system_score = sum(1 for keyword in system_keywords if keyword in request)
        
        # ã‚¹ã‚³ã‚¢ãŒæœ€å¤§ã®ã‚«ãƒ†ã‚´ãƒªã‚’åˆ¤æ–­
        max_score = max(data_score, operation_score, system_score)
        
        # ã‚¹ã‚³ã‚¢ã«åŸºã¥ã„ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã‚’åˆ¤æ–­ï¼ˆåŒç‚¹ã®å ´åˆã¯å„ªå…ˆé †ä½ã‚’è¨­å®šï¼‰
        if max_score > 0:
            if data_score == max_score:
                return "data"
            elif operation_score == max_score:
                return "operation"
            elif system_score == max_score:
                return "system"
        
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ä¸€èˆ¬çš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        return "general"
    
    def _initialize_sub_agents_if_needed(self):
        """
        å¿…è¦ã«å¿œã˜ã¦ä¸‹ä½ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’åˆæœŸåŒ–ã™ã‚‹
        """
        # ãƒ‡ãƒ¼ã‚¿ç®¡ç†çŒ«ã®åˆæœŸåŒ–
        if self.data_manager is None:
            self.data_manager = DataManagerCat(storage=None, debug_mode=self.debug_mode)
            
        # æ¥­å‹™é‚è¡ŒçŒ«ã®åˆæœŸåŒ–ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
        # if self.operation_manager is None:
        #     self.operation_manager = OperationManagerCat(storage=self.storage, debug_mode=self.debug_mode)
            
        # ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†çŒ«ã®åˆæœŸåŒ–ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
        # if self.system_manager is None:
        #     self.system_manager = SystemManagerCat(storage=self.storage, debug_mode=self.debug_mode)
